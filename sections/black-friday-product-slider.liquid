<section class="black-friday-slider-section" style="background-color: {{ section.settings.bg_color }}">
  <div class="black-friday-slider-container page-width">
    {% if section.settings.heading != blank %}
      <h2 class="black-friday-slider-heading">{{ section.settings.heading }}</h2>
    {% endif %}

    {% assign collection = collections[section.settings.collection] %}
    {% if collection and collection.products_count > 0 %}
      <div class="black-friday-product-slider splide" id="black-friday-sliders-{{ section.id }}">
        <div class="splide__track">
          <ul class="splide__list">
            {% for product in collection.products %}
              <li class="splide__slide black-friday-item">
                <div class="black-friday-card">
                  <div class="product-image">
                    <div class="product-quantity">
                      {% assign first_variant = product.variants.first %}
                      {% if first_variant.inventory_management %}
                        <p>
                          Only {{ first_variant.inventory_quantity }} left
                        </p>
                      {% else %}
                        <p>
                          Sold Out
                        </p>
                      {% endif %}
                    </div>
                    <a href="{{ product.url }}">
                      {% if product.featured_image %}
                        <img
                          src="{{ product.featured_image | image_url: width: 300, height: 300, crop: 'center' }}"
                          alt="{{ product.title | escape }}"
                          loading="lazy"
                          width="300"
                          height="300"
                          class="product-img"
                        >
                      {% endif %}
                    </a>
                    {% unless product.available %}
                      <span class="sold-out">Sold Out</span>
                    {% endunless %}
                  </div>

                  <div class="product-info">
                    <!-- Judge.me REVIEW STAR -->
                    {% if product.metafields.judgeme.badge != blank%}
                    <div class="product-reviews" style="margin-top: 20px;">
                      <div
                        style="{{ jm_style }}"
                        class="jdgm-widget jdgm-preview-badge"
                        data-id="{{ product.id }}"
                        data-auto-install="false"
                      >
                        {{ product.metafields.judgeme.badge }}
                      </div>
                    </div>
                    {% endif %}

                    <h3 class="product-title">
                      <a href="{{ product.url }}">{{ product.title }}</a>
                    </h3>

                    {% if product.description != blank %}
                      <p class="product-description">
                        {{ product.description | strip_html | truncate: 80 }}
                      </p>
                    {% endif %}

                    <div class="product-price">
                      <span class="price">{{ product.price | money }}</span>
                      {% if product.compare_at_price > product.price %}
                        <span class="compare-price">{{ product.compare_at_price | money }}</span>
                      {% endif %}
                    </div>

                    <div class="product-buttons">
                      <div class="quick-buy-btn">
                        <button
                          type="button"
                          @click="
                            $store.ajaxProductPage.show({
                              productHandle: '{{ product.handle }}',
                              variantID: '{{ selected_or_first_available_variant.id }}',
                            })
                          "
                        >
                          <span>
                            {{- 'products.product.quick_view' | t -}}
                          </span>
                        </button>
                      </div>
                      <form method="post" action="/cart/add">
                        <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                        <button type="submit" class="add-to-cart-btn" {% unless product.available %}disabled{% endunless %}>
                          <img src="{{ 'cart-icons.svg' | asset_url }}" alt="Add to Cart" width="20" height="20">
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% else %}
      <p class="no-products">No products found in this collection.</p>
    {% endif %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const slider = document.querySelector('#black-friday-sliders-{{ section.id }}');
    if (slider && typeof Splide !== 'undefined') {
      new Splide(slider, {
        type: 'loop',
        perPage: 6,
        perMove: 1,
        arrows: false,
        focus: 'center',
        gap: '1rem',
        pagination: false,
        breakpoints: {
          1200: { perPage: 3 },
          768: { perPage: 2 },
          480: { perPage: 1 }
        }
      }).mount();
    }
  });
</script>

<style>
#black-friday-sliders-{{ section.id }} .splide__track {
  overflow: visible;
}

#black-friday-sliders-{{ section.id }} .splide__slide {
  transform: scale(0.95);
  transition: transform 0.3s ease;
}

#black-friday-sliders-{{ section.id }} .splide__slide.is-active {
  transform: scale(1);
}
.black-friday-slider-container.page-width {
  padding: 60px 0;
}
.black-friday-slider-section {
  color: #fff;
}
.black-friday-card {
  width: 300px;
  height: auto;
  background: transparent;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  overflow: hidden;
}
.black-friday-slider-heading {
  text-align: center;
  margin-bottom: 40px;
  font-size: 2rem;
  font-weight: 700;
}
.product-image img {
  width: 100%;
  border-radius: 8px;
}
.product-image {
  position: relative;
  width: 300px;
  height: 300px;
  margin: 0 auto;
  overflow: hidden;
  border-radius: 8px;
}
.product-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
}
.product-quantity {
  position: absolute;
  background-color: #FAC848;
  border-radius: 50px;
  color: #000;
  padding: 5px 10px;
  top: 10px;
  right: 10px;
  font-size: 16px;
  font-family: Inter, sans-serif;
  font-weight: 600;
}
.product-title {
  font-size: 20px;
  font-family: Libre baskerville, serif;
  margin: 10px 0;
  font-weight: 700;
}
.product-reviews {
  color: #facc15;
  font-size: 14px;
}
.product-description {
  font-size: 14px;
  font-family: Inter, sans-serif;
  color: #FFFFFF;
}
.product-price {
  font-size: 16px;
  margin: 8px 0;
}
.product-price .compare-price {
  text-decoration: line-through;
  color: #999;
  margin-left: 5px;
}
.product-buttons {
  display: flex;
  gap: 10px;
  margin-top: 12px;
  align-items: center;
}
.quick-view-btn,
.add-to-cart-btn {
  background: #fff;
  color: #000;
  border: none;
  padding: 10px;
  font-weight: 600;
  border-radius: 50px;
  cursor: pointer;
  transition: background 0.3s;
}
.quick-view-btn:hover,
.add-to-cart-btn:hover {
  background: #f3f3f3;
}
.no-products {
  text-align: center;
  color: #aaa;
}
.quick-buy-btn {
  padding: 10px 20px;
  width: 90%;
  border: 1px solid #fff;
  border-radius: 50px;
  margin: auto;
  cursor: pointer;
  transition: background 0.3s;
}
</style>

{% schema %}
{
  "name": "Product Slider",
  "tag": "section",
  "class": "black-friday-slider",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop Bestsellers"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Select Collection"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "Black Friday Product Slider",
      "category": "Black Friday"
    }
  ]
}
{% endschema %}
