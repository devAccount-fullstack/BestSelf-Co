{% liquid
  assign images = product.media | where: 'media_type', 'image'
  assign custom_image = custom_image | default: images[0]
  assign _badge_position = badge_position | default: 'overlay'
%}

<section class="black-friday-slider-section" style="background-color: {{ section.settings.bg_color }}">
  <div class="black-friday-slider-container page-width">
    {% if section.settings.heading != blank %}
      <h2 class="black-friday-slider-heading">{{ section.settings.heading }}</h2>
    {% endif %}

    {% assign collection = collections[section.settings.collection] %}
    {% if collection and collection.products_count > 0 %}
      <div class="black-friday-product-slider splide" id="black-friday-slider-{{ section.id }}">
        <div class="splide__track">
          <ul class="splide__list">
            {% for product in collection.products %}
              <li class="splide__slide black-friday-item">
                <div class="black-friday-card">
                  <div class="product-image">
                    <a href="{{ product.url }}">
                      {% if product.featured_image %}
                        <img
                          src="{{ product.featured_image | image_url: width: 300, height: 300, crop: 'center' }}"
                          alt="{{ product.title | escape }}"
                          loading="lazy"
                          class="product-img"
                        >
                      {% else %}
                        <img
                          src="{{ 'placeholder.jpg' | asset_url }}"
                          alt="No image available"
                          loading="lazy"
                          width="300"
                          height="300"
                          class="product-img"
                        >
                      {% endif %}
                    </a>
                    {% unless product.available %}
                      <span class="sold-out">Sold Out</span>
                    {% endunless %}
                  </div>

                  <div class="product-info">
                    <h3 class="product-title">
                      <a href="{{ product.url }}">{{ product.title }}</a>
                    </h3>

                  <!-- Judge.me REVIEW STAR -->
                  <div class="tw-flex tw-h-6">
                    <div
                      style="{{ jm_style }}"
                      class="jdgm-widget jdgm-preview-badge"
                      data-id="{{ product.id }}"
                      data-auto-install="false"
                    >
                      {{ product.metafields.judgeme.badge }}
                    </div>
                  </div>

                    {% if product.description != blank %}
                      <p class="product-description">
                        {{ product.description | strip_html | truncate: 80 }}
                      </p>
                    {% endif %}

                    <div class="product-price">
                      <span class="price">{{ product.price | money }}</span>
                      {% if product.compare_at_price > product.price %}
                        <span class="compare-price">{{ product.compare_at_price | money }}</span>
                      {% endif %}
                    </div>

                    <div class="product-buttons">
                      <button type="button" class="quick-view-btn">Quick View</button>
                      <form method="post" action="/cart/add">
                        <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                        <button type="submit" class="add-to-cart-btn" {% unless product.available %}disabled{% endunless %}>
                          Add to Cart
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% else %}
      <p class="no-products">No products found in this collection.</p>
    {% endif %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const slider = document.querySelector('#black-friday-slider-{{ section.id }}');
    if (slider && typeof Splide !== 'undefined') {
      new Splide(slider, {
        type: 'loop',
        perPage: 4,
        perMove: 1,
        gap: '1rem',
        pagination: false,
        breakpoints: {
          1200: { perPage: 3 },
          768: { perPage: 2 },
          480: { perPage: 1 }
        }
      }).mount();
    }
  });
</script>

<style>
.black-friday-slider-section {
  color: #fff;
}
.black-friday-slider-heading {
  text-align: center;
  margin-bottom: 40px;
  font-size: 2rem;
  font-weight: 700;
}
.black-friday-card {
  background: #111;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  transition: transform 0.3s ease;
}
.black-friday-card:hover {
  transform: translateY(-5px);
}
.product-image {
  position: relative;
}
.product-image img {
  width: 100%;
  border-radius: 8px;
}
.sold-out {
  position: absolute;
  top: 8px;
  left: 8px;
  background: #ff4444;
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
}
.product-title {
  font-size: 18px;
  margin: 10px 0;
  font-weight: 600;
}
.product-reviews {
  color: #facc15;
  font-size: 14px;
}
.product-description {
  font-size: 14px;
  color: #ccc;
  margin: 10px 0;
}
.product-price {
  font-size: 16px;
  margin: 8px 0;
}
.product-price .compare-price {
  text-decoration: line-through;
  color: #999;
  margin-left: 5px;
}
.product-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 12px;
}
.quick-view-btn,
.add-to-cart-btn {
  background: #facc15;
  color: #000;
  border: none;
  padding: 8px 14px;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s;
}
.quick-view-btn:hover,
.add-to-cart-btn:hover {
  background: #eab308;
}
.no-products {
  text-align: center;
  color: #aaa;
}
</style>

{% schema %}
{
  "name": "Product Slider",
  "tag": "section",
  "class": "black-friday-slider",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop Bestsellers"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Select Collection"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "Black Friday Product Slider",
      "category": "Black Friday"
    }
  ]
}
{% endschema %}
