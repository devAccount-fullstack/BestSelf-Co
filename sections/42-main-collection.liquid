{% liquid
  assign anchor_id = section.settings.anchor_id | escape
  assign product_per_page = section.settings.product_per_page | default: 18

  assign pt_mob = section.settings.pt_mob
  assign pb_mob = section.settings.pb_mob
  assign pt_tab = section.settings.pt_tab
  assign pb_tab = section.settings.pb_tab
  assign pt_desk = section.settings.pt_desk
  assign pb_desk = section.settings.pb_desk
%}

{% render 'section-paddings',
  section_id: section.id,
  pt_mob: pt_mob,
  pb_mob: pb_mob,
  pt_tab: pt_tab,
  pb_tab: pb_tab,
  pt_desk: pt_desk,
  pb_desk: pb_desk
%}

<div data-coll-liquid-update class="tw-absolute tw-top-0 tw-left-0 -tw-translate-y-1/2 -tw-translate-x-1/2">
  {% liquid
    assign active_filter_count = 0
    for filter in collection.filters
      for filter_value in filter.active_values
        assign active_filter_count = active_filter_count | plus: 1
      endfor
    endfor
  %}
</div>

<div
  data-section-id="{{ section.id }}"
  id="{{ anchor_id }}"
  x-data="collection({ sectionId: '{{ anchor_id }}' })"
  class="tw-relative"
>
  <!-- FILTERS AND SORT -->
  <div
    class="tw-sticky tw-top-[var(--coll-sticky-top)] tw-z-5 tw-bg-white tw-border-solid tw-border-y tw-border-sc-blue/20"
  >
    <div class="container-42 md:tw-py-3.5 tw-py-2 tw-flex tw-items-center tw-justify-between">
      <!-- FILTER -->
      <div class="">
        <button @click="showDrawer()" type="button" class="tw-flex tw-items-center tw-gap-2">
          {% render 'icon-42', name: 'filters' %}
          <span class="tw-text-black tw-text-base !tw-leading-[20px] tw-font-medium">
            {{- 'collections.general.filters' | t -}}
          </span>
        </button>
      </div>

      <div class="tw-flex tw-items-center tw-gap-6">
        <div data-results-filters-update>
          {% if active_filter_count > 0 %}
            <div class="md:tw-flex tw-justify-center tw-px-4 tw-hidden tw-pt-4 tw-pb-6">
              <span id="ProductCount" class="tw-text-sm tw-text-black tw-opacity-50 tw-leading-[18px] tw-font-medium">
                {{
                  'collections.general.results_with_count'
                  | t: count: collection.products_count, all_products_count: collection.all_products_count
                -}}
              </span>
            </div>
          {% endif %} 
        </div>

        <!-- SORT -->
        <form
          data-filter-sort
          id="sort_desktop"
          @change="applyFilters($el)"
          class="tw-shrink-0"
        >
          <div
            x-data="{ isOpen: false }"
            class="tw-relative"
          >
            <!-- Filter button for toggling visibility -->
            <button
              type="button"
              @click.prevent="isOpen = !isOpen"
              class="tw-flex tw-items-center tw-gap-2"
            >
              {% render 'icon-42', name: 'sort' %}
              <!-- Filter label -->
              <span
                class="tw-text-black tw-flex tw-items-center tw-gap-1 tw-text-base !tw-leading-[20px] tw-font-medium"
              >
                {%- assign isChecked = false %}
                {%- assign option_name = '' %}
                {% for option in collection.sort_options %}
                  {% if option.value == collection.sort_by %}
                    {% assign isChecked = true %}
                    {% assign option_name = option.name | escape %}
                  {% endif %}
                {% endfor %}
                {% if isChecked %}
                  <span class="tw-opacity-50">{{ 'collections.general.sort' | t | append: ':' }}</span>
                  {{- option_name -}}
                {% else %}
                  {{ 'collections.general.sort' | t }}
                {% endif %}
              </span>
            </button>
            <!-- Sort options container -->
            <div
              x-cloak
              x-show="isOpen"
              @click.outside="isOpen = false"
              x-collapse
              class="tw-absolute tw-duration-300 tw-top-[100%] tw-right-0 tw-z-20"
            >
              <ul
                data-
                class="tw-flex tw-flex-col tw-min-w-[165px] tw-mt-2 tw-border-[1px] tw-overflow-hidden tw-border-sc-blue tw-border-solid tw-bg-white"
              >
                <!-- Loop through each sort option -->
                {% liquid
                  assign sort_by = collection.sort_by
                  for option in collection.sort_options
                    if option.value == sort_by
                      assign sort_by_name = option.name
                    endif
                  endfor
                %}

                {% for option in collection.sort_options %}
                  {% assign isChecked = false %}
                  {% if option.value == sort_by %}
                    {% assign isChecked = true %}
                  {% endif %}
                  <li class="tw-w-full tw-flex">
                    <label
                      class="tw-w-full tw-flex tw-py-1 tw-px-2 tw-cursor-pointer tw-duration-300 hover:tw-bg-sc-blue hover:tw-text-white {% if isChecked %}tw-bg-sc-blue tw-text-white{% endif %}"
                      @click="isOpen = false;activeOption = '{{- option.name | escape -}}'"
                    >
                      {% assign checked = checked | default: false %}
                      <div class="">
                        <input
                          id="{{ 'Filter-' | append: option.name | append: '-' | append: forloop.index }}"
                          class="tw-hidden"
                          type="radio"
                          name="sort_by"
                          value="{{- option.value | escape -}}"
                          {% if checked %}
                            checked
                          {% endif %}
                        >
                      </div>
                      <span class="tw-text-sm">{{- option.name | escape -}}</span>
                    </label>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div data-results-filters-update>
    {% if active_filter_count > 0 %}
      <div class="tw-flex tw-justify-center tw-px-4 md:tw-hidden tw-pt-4 tw-pb-6">
        <span id="ProductCount" class="tw-text-sm tw-text-black tw-opacity-50 tw-leading-[18px] tw-font-medium">
          {{
            'collections.general.results_with_count'
            | t: count: collection.products_count, all_products_count: collection.all_products_count
          -}}
        </span>
      </div>
    {% endif %}
  </div>

  <div class="container-42 md:tw-pt-[55px]">
    {% if collection.products.size > 0 %}
      <!-- Display products in a grid with pagination -->
      {% paginate collection.products by product_per_page -%}
        <div
          data-product-list-collection
          class="tw-grid tw-grid-cols-2 lg:tw-grid-cols-4 md:tw-grid-cols-3 tw-gap-x-2.5 tw-gap-y-6 lg:tw-gap-x-5 lg:tw-gap-y-10"
        >
          {% for product in collection.products %}
            <div class="tw-animate-fadeIn tw-h-auto">
              {% render '42-product-card', product: product, class: '' %}
            </div>
          {% endfor %}
        </div>
        <div data-load-more-update class="tw-mt-8 lg:tw-mt-10 tw-flex tw-justify-center">
          {% if paginate.next.url %}
            <button
              type="button"
              @click.prevent="changePage('{{ paginate.next.url }}')"
              class="tw-relative tw-overflow-hidden md:tw-border-sc-blue md:tw-border-[1px] md:tw-border-solid md:tw-py-[8.5px] md:tw-px-[34px] md:tw-rounded-[224px]"
              aria-label="{{ 'collections.general.load_more' | t }}"
            >
              <span class="tw-text-sc-blue md:tw-text-sm tw-text-xs tw-underline md:tw-no-underline tw-uppercase">
                {{ 'collections.general.load_more' | t }}
              </span>
              <span
                x-show="loader"
                class="tw-absolute tw-inset-0 tw-flex tw-justify-center tw-items-center"
              >
                {%- render 'icon-42', name: 'loader', class: 'md:tw-w-7 tw-w-5' -%}
              </span>
              <span class="tw-sr-only">Go to next page</span>
            </button>
          {% endif %}
        </div>
      {%- endpaginate %}
    {% else %}
      <!-- Display message when no products are found -->
      <h3 class="tw-font-bold tw-text-center tw-py-15">
        {{ 'collections.general.no_matches' | t }}
      </h3>
    {% endif %}
  </div>

  <!-- Drawer component for facet filters -->
  {% render '42-filters-drawer', formID: 'facets-desktop' %}
</div>

{% schema %}
{
  "name": "42 Main Collection",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "anchor_id",
      "label": "Anchor id",
      "default": "collection"
    },
    {
      "type": "range",
      "id": "product_per_page",
      "min": 1,
      "max": 48,
      "step": 1,
      "default": 18,
      "label": "Product per page"
    },
    {
      "type": "header",
      "content": "Padding Y settings"
    },
    {
      "type": "number",
      "id": "pt_mob",
      "label": "Mobile padding top in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pb_mob",
      "label": "Mobile padding bottom in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pt_tab",
      "label": "Tablet padding top in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pb_tab",
      "label": "Tablet padding bottom in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pt_desk",
      "label": "Desktop padding top in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pb_desk",
      "label": "Desktop padding bottom in px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "42 Main Collection"
    }
  ]
}
{% endschema %}
