{% liquid
  assign anchor_id = section.settings.anchor_id | handleize

  assign product_id = product.id

  assign metaobject_content = section.settings.metaobject_content | first

  assign title = section.settings.title
  assign title = title | replace: '[[', '<span style="color: #2C3C60;">' | replace: ']]', '</span>'

  assign comparison_topic_1 = section.settings.purpose_label
  assign comparison_topic_2 = section.settings.focus_label
  assign comparison_topic_3 = section.settings.tone_label
  assign comparison_topic_4 = section.settings.unique_advantage_label
  assign comparison_topic_5 = section.settings.best_for_label
  assign comparison_topic_6 = section.settings.number_cards_label

  assign ID = '0'

  if metaobject_content != blank
    assign comparison_topic_1 = metaobject_content.comparison_topic_1
    assign comparison_topic_2 = metaobject_content.comparison_topic_2
    assign comparison_topic_3 = metaobject_content.comparison_topic_3
    assign comparison_topic_4 = metaobject_content.comparison_topic_4
    assign comparison_topic_5 = metaobject_content.comparison_topic_5
    assign comparison_topic_6 = metaobject_content.comparison_topic_6
  endif

  assign pt_mob = section.settings.pt_mob
  assign pb_mob = section.settings.pb_mob
  assign pt_tab = section.settings.pt_tab
  assign pb_tab = section.settings.pb_tab
  assign pt_desk = section.settings.pt_desk
  assign pb_desk = section.settings.pb_desk
%}

{% render 'section-paddings',
  section_id: section.id,
  pt_mob: pt_mob,
  pb_mob: pb_mob,
  pt_tab: pt_tab,
  pb_tab: pb_tab,
  pt_desk: pt_desk,
  pb_desk: pb_desk
%}

{% if metaobject_content != blank %}
  <div
    data-section-id="{{ section.id }}"
    id="{{ anchor_id }}"
    x-data="{ activeId: '{{ ID }}' }"
  >
    {% comment %} Mobile {% endcomment %}
    <div class="tw-overflow-hidden lg:tw-hidden">
      {% if title != blank %}
        <h2 class="tw-px-4 tw-font-bold tw-text-black tw-text-[28px] tw-leading-[34px] tw-mb-[35px]">{{ title }}</h2>
      {% endif %}

      <ul class="tw-flex tw-gap-4 tw-px-4 tw-flex-nowrap tw-items-stretch tw-overflow-x-auto no-scrollbar tw-mb-5">
        {% if metaobject_content != blank %}
          {% for i in (1..3) %}
            {% capture product_key %}product_{{- i -}}{% endcapture %}
            {% capture product_img_key %}product_image_{{- i -}}{% endcapture %}
            {% capture order_key %}product_position_{{- i -}}{% endcapture %}

            {% liquid
              assign block_product = all_products[metaobject_content[product_key]]
              assign product_image = metaobject_content[product_img_key]
              assign block_product_order = metaobject_content[order_key]
              assign product_order = block_product_order | plus: 1

              if block_product.id == product_id
                assign block_product_order = 0
                assign product_order = 0
              endif
            %}
            <div
              class="tw-flex tw-items-center tw-gap-2 tw-p-3 tw-rounded-[22px] tw-border tw-border-solid tw-border-transparent tw-min-w-max tw-max-w-80 tw-h-auto tw-cursor-pointer"
              :class="{ '!tw-border-sc-blue': activeId == '{{ block_product_order }}' }"
              @click="activeId = '{{ block_product_order }}'"
              style="order: {{ product_order }};"
            >
              <div class="tw-shrink-0 tw-flex tw-size-25 tw-overflow-hidden tw-rounded-ra-10 tw-aspect-square">
                {% if product_image != blank %}
                  {{-
                    product_image
                    | image_url: width: product_image.width
                    | image_tag:
                      loading: 'lazy',
                      sizes: 'min(100vw, 100px)',
                      widths: '100',
                      alt: block_product.title,
                      class: 'tw-size-full tw-object-cover tw-aspect-square'
                  -}}
                {% endif %}
              </div>
              <div class="tw-shrink-0 tw-grow tw-flex tw-flex-col tw-gap-1 tw-text-black tw-font-primary tw-text-sm">
                <span class="tw-font-bold">{{ block_product.title }}</span>
                <span class="tw-font-semibold">{{ block_product.price | money_with_currency }}</span>
              </div>

              <button
                class="tw-self-end tw-relative tw-w-10.5 tw-h-10.5 lg:tw-w-[46px] lg:tw-h-[46px] tw-flex tw-items-center tw-justify-center tw-bg-sc-blue tw-shrink-0 tw-rounded-full tw-transition-all tw-duration-200 hover:tw-bg-sc-blue/90"
                @click="$store.cart.addToCart([{ id: '{{ block_product.selected_or_first_available_variant.id }}', quantity: 1 }], true); isShowPairsWellWith = false"
                type="button"
                :class="{'tw-pointer-events-none tw-opacity-70' : block_product.selected_or_first_available_variant?.available === false}"
              >
                <span x-show="!$store.cart.isLoading">
                  {% render 'icon-42', name: 'cart-icon' %}
                </span>
                <span
                  x-show="$store.cart.isLoading"
                  class="tw-absolute tw-inset-0 tw-flex tw-justify-center tw-items-center"
                >
                  {%- render 'icon-42', name: 'loader', class: 'tw-w-5 !tw-text-white !tw-fill-sc-blue' -%}
                </span>
              </button>
            </div>
          {% endfor %}
        {% else %}
          {% comment %}
            {% for block in blocks %}
              {% liquid
                assign block_product = block.settings.block_product
                assign product_image = block.settings.product_image
              %}
              <div
                class="tw-flex tw-items-center tw-gap-2 tw-p-3 tw-rounded-[22px] tw-border tw-border-solid tw-border-transparent tw-min-w-max tw-max-w-80 tw-h-auto tw-cursor-pointer"
                :class="{ '!tw-border-sc-blue': activeId == '{{ block_product.id }}' }"
                @click="activeId = '{{ block_product.id }}'"
              >
                <div class="tw-shrink-0 tw-flex tw-size-25 tw-overflow-hidden tw-rounded-ra-10 tw-aspect-square">
                  {% if product_image != blank %}
                    {{-
                      product_image
                      | image_url: width: product_image.width
                      | image_tag:
                        loading: 'lazy',
                        sizes: 'min(100vw, 100px)',
                        widths: '100',
                        alt: block_product.title,
                        class: 'tw-size-full tw-object-cover tw-aspect-square'
                    -}}
                  {% endif %}
                </div>
                <div class="tw-shrink-0 tw-grow tw-flex tw-flex-col tw-gap-1 tw-text-black tw-font-primary tw-text-sm">
                  <span class="tw-font-bold">{{ block_product.title }}</span>
                  <span class="tw-font-semibold">{{ block_product.price | money_with_currency }}</span>
                </div>
              </div>
            {% endfor %}
          {% endcomment %}
        {% endif %}
      </ul>

      {% assign label_class = 'tw-flex tw-items-center tw-text-white tw-font-semibold tw-text-sm tw-leading-6 tw-py-4 tw-pr-3.75 tw-min-w-max tw-border tw-border-x-0 tw-border-t-0 tw-border-solid tw-border-white' %}
      {% assign value_class = 'tw-flex tw-items-center tw-text-white tw-font-semibold tw-text-sm tw-leading-6 tw-py-1 tw-px-5 tw-border tw-border-r-0 tw-border-t-0 tw-border-solid tw-border-white' %}

      {% if metaobject_content != blank %}
        {% for i in (1..3) %}
          {% capture product_key %}product_{{- i -}}{% endcapture %}
          {% capture order_key %}product_position_{{- i -}}{% endcapture %}

          {% liquid
            assign block_product = all_products[metaobject_content[product_key]]
            assign block_product_order = metaobject_content[order_key]

            assign block_product = all_products[metaobject_content[product_key]]
            assign product_comparing_table_content = block_product.metafields.custom.product_comparing_table_content.value | first

            if block_product.id == product_id
              assign block_product_order = 0
            endif
          %}

          <div
            x-cloak
            x-show="activeId == '{{ block_product_order }}'"
          >
            <div class="tw-grid tw-grid-cols-[auto,1fr] tw-px-4 tw-py-8 tw-rounded-ra-20 tw-overflow-hidden tw-bg-sc-blue">
              {% if product_comparing_table_content != blank %}
                {% assign index_mob = 1 %}
                {% for item in product_comparing_table_content.items.value %}
                  {% if index_mob <= 6 %}
                    {% capture topic_key %}comparison_topic_{{- index_mob -}}{% endcapture %}
                    {% assign topic = metaobject_content[topic_key] %}

                    <div class="{{ label_class }}">{{ topic }}</div>
                    <div class="{{ value_class }}">{{ item }}</div>
                  {% endif %}
                  {% assign index_mob = index_mob | plus: 1 %}
                {% endfor %}

              {% else %}
                {% for j in (1..6) %}
                  {% capture topic_key %}comparison_topic_{{- j -}}{% endcapture %}
                  {% capture text_key %}product_{{- i -}}_comparison_text_{{- j -}}{% endcapture %}
                  {% assign topic = metaobject_content[topic_key] %}
                  {% assign text = metaobject_content[text_key] %}

                  <div class="{{ label_class }}">{{ topic }}</div>
                  <div class="{{ value_class }}">{{ text }}</div>
                {% endfor %}
              {% endif %}
            </div>
          </div>
        {% endfor %}

      {% else %}
        {% comment %}
          {% for block in blocks %}
            {% liquid
              assign block_product = block.settings.block_product
              assign purpose_value = block.settings.purpose_value
              assign focus_value = block.settings.focus_value
              assign tone_value = block.settings.tone_value
              assign unique_advantage_value = block.settings.unique_advantage_value
              assign best_for_value = block.settings.best_for_value
              assign number_cards_value = block.settings.number_cards_value
            %}
            <div
              x-cloak
              x-show="activeId == '{{ block_product.id }}'"
              class="tw-grid tw-grid-cols-[auto,1fr] tw-px-4 tw-py-8 tw-rounded-ra-20 tw-overflow-hidden tw-bg-sc-blue"
            >
              <div class="{{ label_class }}">{{ comparison_topic_1 }}</div>
              <div class="{{ value_class }}">{{ purpose_value }}</div>

              <div class="{{ label_class }}">{{ comparison_topic_2 }}</div>
              <div class="{{ value_class }}">{{ focus_value }}</div>

              <div class="{{ label_class }}">{{ comparison_topic_3 }}</div>
              <div class="{{ value_class }}">{{ tone_value }}</div>

              <div class="{{ label_class }}">{{ comparison_topic_4 }}</div>
              <div class="{{ value_class }}">{{ unique_advantage_value }}</div>

              <div class="{{ label_class }}">{{ comparison_topic_5 }}</div>
              <div class="{{ value_class }}">{{ best_for_value }}</div>

              <div class="{{ label_class }} !tw-border-b-0">{{ comparison_topic_6 }}</div>
              <div class="{{ value_class }} !tw-border-b-0">{{ number_cards_value }}</div>
            </div>
          {% endfor %}
        {% endcomment %}
      {% endif %}
    </div>

    {% comment %} Desktop {% endcomment %}
    <div class="tw-hidden container-42 lg:tw-block">
      {% assign class_desk = 'tw-flex tw-items-center tw-text-white tw-font-semiboldtw-text-lg tw-leading-[26px] tw-px-2 tw-py-5 tw-border tw-border-x-0 tw-border-t-0 tw-border-solid tw-border-white' %}

      <div class="lg:tw-grid tw-grid-cols-[346px,1fr,1fr,1fr] tw-pr-5">
        <h2 class="tw-flex tw-flex-col tw-justify-center tw-text-[40px] tw-font-bold tw-leading-[50px] tw-pr-2">
          {{ title }}
        </h2>

        {% if metaobject_content != blank %}
          {% for i in (1..3) %}
            {% capture product_key %}product_{{- i -}}{% endcapture %}
            {% capture product_img_key %}product_image_{{- i -}}{% endcapture %}
            {% capture order_key %}product_position_{{- i -}}{% endcapture %}
            {% liquid
              assign block_product = all_products[metaobject_content[product_key]]
              assign product_image = metaobject_content[product_img_key]
              assign block_product_order = metaobject_content[order_key]
              assign product_order = block_product_order | plus: 1

              if block_product.id == product_id
                assign block_product_order = 0
                assign product_order = 0
              endif
            %}

            <div
              class="tw-border tw-border-b-0 tw-border-solid tw-border-transparent tw-rounded-t-3xl tw-p-4.5"
              :class="{ '!tw-border-sc-blue': activeId == '{{ block_product_order }}' }"
              @click="activeId = '{{ block_product_order }}'"
              style="order: {{ product_order }};"
            >
              <div class="tw-relative tw-shrink-0 tw-flex tw-w-full tw-overflow-hidden tw-rounded-ra-16 tw-aspect-square tw-mb-2">
                {% if product_image != blank %}
                  {{-
                    product_image
                    | image_url: width: product_image.width
                    | image_tag:
                      loading: 'lazy',
                      sizes: 'min(100vw, 500px)',
                      widths: '100,200,300,400,500',
                      alt: block_product.title,
                      class: 'tw-size-full tw-object-cover tw-aspect-square'
                  -}}
                {% endif %}

                <button
                  class="tw-absolute tw-bottom-2 tw-right-2 tw-z-5 tw-w-10.5 tw-h-10.5 lg:tw-w-[46px] lg:tw-h-[46px] tw-flex tw-items-center tw-justify-center tw-bg-sc-blue tw-shrink-0 tw-rounded-full tw-transition-all tw-duration-200 hover:tw-bg-sc-blue/90"
                  @click="$store.cart.addToCart([{ id: '{{ block_product.selected_or_first_available_variant.id }}', quantity: 1 }], true); isShowPairsWellWith = false"
                  type="button"
                  :class="{'tw-pointer-events-none tw-opacity-70' : block_product.selected_or_first_available_variant?.available === false}"
                >
                  <span x-show="!$store.cart.isLoading">
                    {% render 'icon-42', name: 'cart-icon' %}
                  </span>
                  <span
                    x-show="$store.cart.isLoading"
                    class="tw-absolute tw-inset-0 tw-flex tw-justify-center tw-items-center"
                  >
                    {%- render 'icon-42', name: 'loader', class: 'tw-w-5 !tw-text-white !tw-fill-sc-blue' -%}
                  </span>
                </button>
              </div>
              <div class="tw-flex tw-flex-col tw-gap-1.5 tw-text-xl tw-leading-[35px] tw-mb-[5px]">
                <span class="tw-font-primary tw-font-bold">
                  {{- block_product.title }}
                </span>
                <span class="tw-font-secondary tw-font-semibold">{{ block_product.price | money_with_currency -}}</span>
              </div>
            </div>
          {% endfor %}
        {% else %}
          {% comment %}
            {% for block in blocks %}
              {% liquid
                assign block_product = block.settings.block_product
                assign product_image = block.settings.product_image
                assign purpose_value = block.settings.purpose_value
                assign focus_value = block.settings.focus_value
                assign tone_value = block.settings.tone_value
                assign unique_advantage_value = block.settings.unique_advantage_value
                assign best_for_value = block.settings.best_for_value
                assign number_cards_value = block.settings.number_cards_value
              %}

              <div
                class="tw-border tw-border-b-0 tw-border-solid tw-border-transparent tw-rounded-t-3xl tw-p-4.5"
                :class="{ '!tw-border-sc-blue': activeId == '{{ block_product.id }}' }"
                @click="activeId = '{{ block_product.id }}'"
              >
                <div class="tw-shrink-0 tw-flex tw-w-full tw-overflow-hidden tw-rounded-ra-16 tw-aspect-square tw-mb-2">
                  {% if product_image != blank %}
                    {{-
                      product_image
                      | image_url: width: product_image.width
                      | image_tag:
                        loading: 'lazy',
                        sizes: 'min(100vw, 500px)',
                        widths: '100,200,300,400,500',
                        alt: block_product.title,
                        class: 'tw-size-full tw-object-cover tw-aspect-square'
                    -}}
                  {% endif %}
                </div>
                <div class="tw-flex tw-flex-col tw-gap-1.5 tw-text-xl tw-leading-[35px] tw-mb-[5px]">
                  <span class="tw-font-primary tw-font-bold">{{ block_product.title }}</span>
                  <span class="tw-font-secondary tw-font-semibold">{{ block_product.price | money_with_currency }}</span>
                </div>
              </div>
            {% endfor %}
          {% endcomment %}
        {% endif %}
      </div>

      {% if metaobject_content != blank %}
        <div class="tw-grid tw-grid-cols-[346px,1fr,1fr,1fr] tw-grid-rows-6 tw-grid-flow-col tw-rounded-[40px] tw-pb-3 tw-bg-sc-blue tw-text-white tw-pr-5">
          <div class="{{ class_desk }} tw-ml-5 !tw-pt-8">{{ comparison_topic_1 }}</div>
          <div class="{{ class_desk }} tw-ml-5">{{ comparison_topic_2 }}</div>
          <div class="{{ class_desk }} tw-ml-5">{{ comparison_topic_3 }}</div>
          <div class="{{ class_desk }} tw-ml-5">{{ comparison_topic_4 }}</div>
          <div class="{{ class_desk }} tw-ml-5">{{ comparison_topic_5 }}</div>
          <div class="{{ class_desk }} tw-ml-5 tw-border-b-0">{{ comparison_topic_6 }}</div>

          {% for i in (1..3) %}
            {% capture product_key %}product_{{- i -}}{% endcapture %}
            {% capture order_key %}product_position_{{- i -}}{% endcapture %}

            {% liquid
              assign block_product = all_products[metaobject_content[product_key]]
              assign product_comparing_table_content = block_product.metafields.custom.product_comparing_table_content.value | first

              assign block_product_order = metaobject_content[order_key]
              assign product_order = block_product_order | plus: 1

              if block_product.id == product_id
                assign block_product_order = 0
                assign product_order = 0
              endif
            %}

            {% if product_comparing_table_content != blank %}
              {% assign index = 1 %}
              {% for item in product_comparing_table_content.items.value %}
                {% if index <= 6 %}
                  <div
                    class="{{ class_desk }} !tw-px-4.5 !tw-text-base {% if index == 6 %}tw-border-b-0 tw-rounded-b-3xl{% endif %}"
                    :class="{ 'tw-bg-white !tw-border-sc-blue !tw-border-x !tw-text-black': activeId == '{{ block_product_order }}' }"
                    style="order: {{ product_order }};"
                  >
                    {{ item }}
                  </div>
                {% endif %}
                {% assign index = index | plus: 1 %}
              {% endfor %}
            {% else %}
              {% for j in (1..6) %}
                {% capture topic_key %}comparison_topic_{{- j -}}{% endcapture %}
                {% capture text_key %}product_{{- i -}}_comparison_text_{{- j -}}{% endcapture %}
                {% assign topic = metaobject_content[topic_key] %}
                {% assign text = metaobject_content[text_key] %}

                <div
                  class="{{ class_desk }} !tw-px-4.5 !tw-text-base {% if forloop.last %}tw-border-b-0 tw-rounded-b-3xl{% endif %}"
                  :class="{ 'tw-bg-white !tw-border-sc-blue !tw-border-x !tw-text-black': activeId == '{{ block_product_order }}' }"
                  style="order: {{ product_order }};"
                >
                  {{ text }}
                </div>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </div>

      {% else %}
        {% comment %}
          <div class="tw-grid tw-grid-cols-[346px,1fr,1fr,1fr] tw-grid-rows-6 tw-grid-flow-col tw-rounded-[40px] tw-pb-3 tw-bg-sc-blue tw-text-white tw-pr-5">
            <div class="{{ class_desk }} tw-ml-5 !tw-pt-8">{{ comparison_topic_1 }}</div>
            <div class="{{ class_desk }} tw-ml-5">{{ comparison_topic_2 }}</div>
            <div class="{{ class_desk }} tw-ml-5">{{ comparison_topic_3 }}</div>
            <div class="{{ class_desk }} tw-ml-5">{{ comparison_topic_4 }}</div>
            <div class="{{ class_desk }} tw-ml-5">{{ comparison_topic_5 }}</div>
            <div class="{{ class_desk }} tw-ml-5 tw-border-b-0">{{ comparison_topic_6 }}</div>

            {% for block in blocks %}
              {% liquid
                assign block_product = block.settings.block_product
                assign purpose_value = block.settings.purpose_value
                assign focus_value = block.settings.focus_value
                assign tone_value = block.settings.tone_value
                assign unique_advantage_value = block.settings.unique_advantage_value
                assign best_for_value = block.settings.best_for_value
                assign number_cards_value = block.settings.number_cards_value
              %}

              <div
                class="{{ class_desk }} !tw-px-4.5 !tw-text-base {% if forloop.last %}tw-border-b-0 tw-rounded-b-3xl{% endif %}"
                :class="{ 'tw-bg-white !tw-border-sc-blue !tw-border-x !tw-text-black': activeId == '{{ block_product.id }}' }"
              >
                {{ purpose_value }}
              </div>
              <div
                class="{{ class_desk }} !tw-px-4.5 !tw-text-base"
                :class="{ 'tw-bg-white !tw-border-sc-blue !tw-border-x !tw-text-black': activeId == '{{ block_product.id }}' }"
              >
                {{ focus_value }}
              </div>
              <div
                class="{{ class_desk }} !tw-px-4.5 !tw-text-base"
                :class="{ 'tw-bg-white !tw-border-sc-blue !tw-border-x !tw-text-black': activeId == '{{ block_product.id }}' }"
              >
                {{ tone_value }}
              </div>
              <div
                class="{{ class_desk }} !tw-px-4.5 !tw-text-base"
                :class="{ 'tw-bg-white !tw-border-sc-blue !tw-border-x !tw-text-black': activeId == '{{ block_product.id }}' }"
              >
                {{ unique_advantage_value }}
              </div>
              <div
                class="{{ class_desk }} !tw-px-4.5 !tw-text-base"
                :class="{ 'tw-bg-white !tw-border-sc-blue !tw-border-x !tw-text-black': activeId == '{{ block_product.id }}' }"
              >
                {{ best_for_value }}
              </div>
              <div
                class="{{ class_desk }} !tw-px-4.5 !tw-text-base tw-border-b-0 tw-rounded-b-3xl"
                :class="{ 'tw-bg-white !tw-border-sc-blue !tw-border-x !tw-text-black': activeId == '{{ block_product.id }}' }"
              >
                {{ number_cards_value }}
              </div>
            {% endfor %}
          </div>
        {% endcomment %}
      {% endif %}
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "42 Perfect match",
  "tag": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Section",
      "info": "All content in this section is pulled from the [Product comparing](https://admin.shopify.com/store/bestselfco/content/metaobjects/entries/product_comparing) metaobject assigned in the metafield [Comparing table. Perfect match](https://admin.shopify.com/store/bestselfco/settings/custom_data/product/metafields/104346320965).\n\nIf the product metafield [Product comparing table content](https://admin.shopify.com/store/bestselfco/settings/custom_data/product/metafields/104737275973) is populated, the table content will be taken from the assigned [Product Comparing Table Content](https://admin.shopify.com/store/bestselfco/content/metaobjects/entries/product_comparing_table_content) metaobject instead."
    },
    {
      "type": "text",
      "id": "anchor_id",
      "label": "Anchor id",
      "default": "section-name"
    },
    {
      "type": "metaobject_list",
      "id": "metaobject_content",
      "metaobject_type": "product_comparing",
      "label": "Metaobject"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Choose Your [[Perfect Match]]",
      "info": "[[...]] - use for highlight"
    },
    {
      "type": "header",
      "content": "Padding Y settings"
    },
    {
      "type": "number",
      "id": "pt_mob",
      "label": "Mobile padding top in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pb_mob",
      "label": "Mobile padding bottom in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pt_tab",
      "label": "Tablet padding top in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pb_tab",
      "label": "Tablet padding bottom in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pt_desk",
      "label": "Desktop padding top in px",
      "default": 0
    },
    {
      "type": "number",
      "id": "pb_desk",
      "label": "Desktop padding bottom in px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "42 Perfect match"
    }
  ]
}
{% endschema %}
