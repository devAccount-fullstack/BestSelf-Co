{% liquid
  assign cart_progress_message_1 = section.settings.cart_progress_message_1
  assign cart_progress_message_2 = section.settings.cart_progress_message_2
  assign cart_progress_reached_message = section.settings.cart_progress_reached_message

  assign cart_progress_bar_threshold_1 = section.settings.cart_progress_bar_threshold_1 | times: 100
  assign cart_progress_bar_threshold_2 = section.settings.cart_progress_bar_threshold_2 | times: 100
  assign cart_progress_bar_icon_1 = section.settings.cart_progress_bar_icon_1
  assign cart_progress_bar_icon_2 = section.settings.cart_progress_bar_icon_2
%}

<div
  x-cloak
  x-show="$store.cart.obj.item_count > 0"
  class="tw-rounded-xl tw-bg-sc-ice-blue tw-border tw-border-sc-ice-blue tw-px-3 tw-py-[9px] lg:tw-px-4 lg:tw-pb-3"
>
  {% comment %} Progress bar {% endcomment %}
  <div class="tw-grid tw-grid-cols-3 tw-items-start tw-relative">
    <div class="tw-absolute tw-bottom-3.5 tw-translate-y-1/2 tw-bg-sc-light-blue tw-h-1.25 tw-w-full tw-tw-overflow-hidden tw-rounded-full tw-overflow-hidden lg:tw-bottom-4.5">
      <div
        class="tw-bg-sc-blue tw-h-1.25 tw-transition-all tw-duration-300 tw-rounded-full"
        :style="
          {
            width: (() => {
              const total = $store.cart.obj.total_price;
              const { value_1, value_2 } = $store.cart.cart_progress_bar_threshold;
              if (total == 0) return '0%'
              if (total >= value_2) return '100%';
              if (total <= value_1) return `${(total / value_1) * 50}%`;
              const remaining = total - value_1;
              const range = value_2 - value_1;
              return `${50 + (remaining / range) * 50}%`;
            })()
          }
        "
      ></div>
    </div>

    <div class="tw-relative tw-z-1 tw-flex tw-flex-col tw-justify-center tw-items-center tw-gap-[3px] tw-justify-self-center tw-col-start-2 -tw-translate-x-3.75 lg:-tw-translate-x-5">
      <span class="tw-block tw-font-medium tw-leading-none tw-text-[10px] lg:tw-text-[12px] lg:tw-mb-0.5">
        {{- cart_progress_bar_threshold_1 | money_with_currency -}}
      </span>
      <div
        class="tw-flex tw-justify-center tw-items-center tw-size-7 tw-rounded-full tw-bg-sc-light-blue tw-p-[5px] tw-border-2 tw-border-solid tw-border-transparent lg:tw-size-9"
        :class="{ '!tw-border-sc-blue': $store.cart.obj.total_price >= $store.cart.cart_progress_bar_threshold.value_1 }"
      >
        {% if cart_progress_bar_icon_1 != blank %}
          {{-
            cart_progress_bar_icon_1
            | image_url: width: cart_progress_bar_icon_1.width
            | image_tag:
              loading: 'lazy',
              sizes: 'min(100vw, 100px)',
              widths: '100',
              alt: cart_progress_bar_icon_1.alt,
              class: 'tw-h-full tw-w-full tw-object-contain'
          -}}
        {% endif %}
      </div>
    </div>
    <div class="tw-relative tw-z-1 tw-flex tw-flex-col tw-justify-center tw-items-center tw-gap-[3px] tw-justify-self-end tw-col-start-3">
      <span class="tw-font-medium tw-leading-none tw-text-[10px] lg:tw-text-[12px] lg:tw-mb-0.5">
        {{- cart_progress_bar_threshold_2 | money_with_currency -}}
      </span>
      <div
        class="tw-flex tw-justify-center tw-items-center tw-size-7 tw-rounded-full tw-bg-sc-light-blue tw-p-[2px] tw-border-2 tw-border-solid tw-border-transparent lg:tw-size-9"
        :class="{ '!tw-border-sc-blue': $store.cart.obj.total_price >= $store.cart.cart_progress_bar_threshold.value_2 }"
      >
        {% if cart_progress_bar_icon_2 != blank %}
          {{-
            cart_progress_bar_icon_2
            | image_url: width: cart_progress_bar_icon_2.width
            | image_tag:
              loading: 'lazy',
              sizes: 'min(100vw, 100px)',
              widths: '100',
              alt: cart_progress_bar_icon_2.alt,
              class: 'tw-h-full tw-w-full tw-object-contain'
          -}}
        {% endif %}
      </div>
    </div>
  </div>
  {% comment %} Messages {% endcomment %}
  <div class="tw-mt-2 tw-text-[12px] tw-leading-[18px] tw-text-black lg:tw-mt-3 lg:tw-text-[14px] lg:tw-leading-[22px]">
    <span
      x-cloak
      x-show="$store.cart.obj.total_price < $store.cart.cart_progress_bar_threshold.value_1 && $store.cart.obj.total_price < $store.cart.cart_progress_bar_threshold.value_2"
    >
      {{
        cart_progress_message_1
        | replace: '[amount_left]',
          '<span x-text="window.formatMoney($store.cart.cart_progress_bar_threshold.value_1 - $store.cart.obj.total_price)"></span>'
      }}
    </span>

    <span
      x-cloak
      x-show="$store.cart.obj.total_price >= $store.cart.cart_progress_bar_threshold.value_1 && $store.cart.obj.total_price < $store.cart.cart_progress_bar_threshold.value_2"
    >
      {{
        cart_progress_message_2
        | replace: '[amount_left]',
          '<span x-text="window.formatMoney($store.cart.cart_progress_bar_threshold.value_2 - $store.cart.obj.total_price)"></span>'
      }}
    </span>

    <span
      x-cloak
      x-show="$store.cart.obj.total_price >= $store.cart.cart_progress_bar_threshold.value_2"
    >
      {{ cart_progress_reached_message }}
    </span>
  </div>
</div>
